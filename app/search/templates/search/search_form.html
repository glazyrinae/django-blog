{% load sekizai_tags static %}

<form id="{{ form_id }}" class="search-form" 
      data-content-type="{{ config.content_type.id }}"
      data-config-id="{{ config.id }}"
      data-results-limit="{{ config.results_limit }}">
    
    <div class="input-group mb-3">
        <input type="text" 
               class="form-control search-input" 
               placeholder="{{ config.placeholder }}"
               name="q"
               aria-label="Поиск">
        <button class="btn btn-outline-secondary search-button" type="button">
            <i class="bi bi-search"></i>
        </button>
    </div>
    
    <!-- Дополнительные поля -->
    <div class="search-fields mb-3">
        {% for field in fields %}
        <div class="mb-2 search-field-{{ field.field_type }}" 
             data-field-name="{{ field.field_name }}"
             data-field-type="{{ field.field_type }}">
            
            {% if field.field_type == 'text' %}
            
                {% include "items/text.html" with field=field %}
            
            {% elif field.field_type == 'checkbox' %}
            
            <!-- <div class="form-check">
                <input class="form-check-input" 
                       type="checkbox" 
                       name="{{ field.field_name }}"
                       id="field_{{ field.id }}">
                <label class="form-check-label" for="field_{{ field.id }}">
                    {{ field.label }}
                </label>
            </div> -->
            
            {% elif field.field_type == 'radio' %}
            
            <label class="form-label">{{ field.label }}</label>
            <div class="search-dynamic-radio" data-field-id="{{ field.id }}">
                <!-- Динамически загрузится через JS -->
            </div>
            
            {% elif field.field_type == 'select' %}
                {% include "search/items/select.html" with field=field multiple=False %}
            {% elif field.field_type == 'select_multiple' %}
                {% include "search/items/select.html" with field=field multiple=True %}
            {% elif field.field_type == 'number' %}
            <!-- <label class="form-label">{{ field.label }}</label>
            <input type="number" 
                   class="form-control" 
                   name="{{ field.field_name }}"
                   {% if field.min_value is not None %}min="{{ field.min_value }}"{% endif %}
                   {% if field.max_value is not None %}max="{{ field.max_value }}"{% endif %}
                   {% if field.step is not None %}step="{{ field.step }}"{% endif %}
                   placeholder="{{ field.placeholder|default:'' }}"> -->
            {% elif field.field_type == 'range' %}
                {% include "search/items/range.html" with field=field %}
            {% elif field.field_type == 'interval' %}
            
            <!-- <label class="form-label">{{ field.label }}</label>
            <div class="row">
                <div class="col">
                    <input type="number" 
                           class="form-control" 
                           name="{{ field.field_name }}_min"
                           placeholder="От"
                           {% if field.min_value is not None %}min="{{ field.min_value }}"{% endif %}>
                </div>
                <div class="col">
                    <input type="number" 
                           class="form-control" 
                           name="{{ field.field_name }}_max"
                           placeholder="До"
                           {% if field.max_value is not None %}max="{{ field.max_value }}"{% endif %}>
                </div>
            </div> -->
            
            {% elif field.field_type == 'date_range' %}
                {% include "search/items/date_range.html" with field=field %}
            {% elif field.field_type == 'date' %}
                {% include "search/items/date_range.html" with field=field %}
            {% endif %}
        </div>
        {% endfor %}
    </div>
    
    <div class="d-flex justify-content-between align-items-center">
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-search"></i> Искать
        </button>
        
        <button type="button" class="btn btn-outline-secondary search-clear">
            <i class="bi bi-x-circle"></i> Очистить
        </button>
    </div>
</form>

<!-- Результаты поиска -->
<div class="search-results mt-3" id="results-{{ form_id }}">
    <div class="search-loading">
        <div class="spinner-border spinner-border-sm" role="status">
            <span class="visually-hidden">Загрузка...</span>
        </div>
        <span class="ms-2">Поиск...</span>
    </div>
    <div class="search-results-list"></div>
</div>


{% addtoblock "js_header" %}
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
{% endaddtoblock %}

{% addtoblock "js_footer" %}
    <script src="{% static 'search/js/search.js' %}"></script>
{% endaddtoblock %}