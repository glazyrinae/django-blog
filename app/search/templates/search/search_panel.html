
{% load sekizai_tags %}
{% if config %}
<div class="search-panel search-panel-{{ config.position }}" 
     id="search-panel-{{ config.id }}"
     data-config-id="{{ config.id }}"
     data-content-type="{{ config.content_type.id }}">
    
    {% if config.position == 'modal' %}
    <!-- Модальное окно -->
    <button type="button" class="btn btn-primary search-modal-trigger" 
            data-bs-toggle="modal" data-bs-target="#searchModal{{ config.id }}">
        <i class="bi bi-search"></i> Поиск
    </button>
    
    <div class="modal fade" id="searchModal{{ config.id }}" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Поиск</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    {% include "search/search_form.html" %}
                </div>
            </div>
        </div>
    </div>
    
    {% elif config.position == 'left' or config.position == 'right' or config.position == 'top' or config.position == 'bottom' %}
    {% with offcanvas_id="searchOffcanvas"|add:config.id|stringformat:"s" %}
    {% if config.position == 'left' %}
    <div class="offcanvas offcanvas-start"
         tabindex="-1"
         id="{{ offcanvas_id }}"
         aria-labelledby="{{ offcanvas_id }}Label"
         data-bs-scroll="true"
         data-bs-backdrop="false"
         data-bs-keyboard="false">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="{{ offcanvas_id }}Label">Поиск</h5>
        </div>
        <div class="offcanvas-body">
            {% include "search/search_form.html" %}
        </div>
    </div>
    {% elif config.position == 'right' %}
    <div class="offcanvas offcanvas-end"
         tabindex="-1"
         id="{{ offcanvas_id }}"
         aria-labelledby="{{ offcanvas_id }}Label"
         data-bs-scroll="true"
         data-bs-backdrop="false"
         data-bs-keyboard="false">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="{{ offcanvas_id }}Label">Поиск</h5>
        </div>
        <div class="offcanvas-body">
            {% include "search/search_form.html" %}
        </div>
    </div>
    {% elif config.position == 'top' %}
    <div class="offcanvas offcanvas-top"
         tabindex="-1"
         id="{{ offcanvas_id }}"
         aria-labelledby="{{ offcanvas_id }}Label"
         data-bs-scroll="true"
         data-bs-backdrop="false"
         data-bs-keyboard="false">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="{{ offcanvas_id }}Label">Поиск</h5>
        </div>
        <div class="offcanvas-body">
            {% include "search/search_form.html" %}
        </div>
    </div>
    {% else %}
    <div class="offcanvas offcanvas-bottom"
         tabindex="-1"
         id="{{ offcanvas_id }}"
         aria-labelledby="{{ offcanvas_id }}Label"
         data-bs-scroll="true"
         data-bs-backdrop="false"
         data-bs-keyboard="false">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="{{ offcanvas_id }}Label">Поиск</h5>
        </div>
        <div class="offcanvas-body">
            {% include "search/search_form.html" %}
        </div>
    </div>
    {% endif %}
    {% endwith %}

    {% else %}
    <!-- Обычная панель -->
    <div class="search-panel-content">
        {% include "search/search_form.html" %}
    </div>
    {% endif %}
    
</div>

{% addtoblock "js_footer" %}
<script>
  (function () {
    function autoShowSearchOffcanvas() {
      if (!window.bootstrap || !window.bootstrap.Offcanvas) return;

      document.querySelectorAll('.search-panel .offcanvas').forEach(function (el) {
        var instance = window.bootstrap.Offcanvas.getOrCreateInstance(el, {
          backdrop: false,
          scroll: true,
          keyboard: false
        });
        instance.show();
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', autoShowSearchOffcanvas);
    } else {
      autoShowSearchOffcanvas();
    }
  })();
</script>
{% endaddtoblock %}
{% endif %}
