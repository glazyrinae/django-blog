{% load sekizai_tags static %}

{% addtoblock "css" %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css">
    <style>
        .range-slider-wrapper {
            border-radius: 0.375rem;
            padding: 15px;
            margin-bottom: 20px;
        }
        /* Accordion: без зелёного фона/подсветки в активном состоянии и без изменения оформления текста */
        .range-accordion .accordion-button {
            font-weight: inherit;
        }
        .range-accordion .accordion-button:focus {
            box-shadow: none;
        }
        .range-accordion .accordion-button:not(.collapsed) {
            color: inherit;
            background-color: transparent;
            box-shadow: none;
        }
        .slider-container {
            padding: 15px;
            border-radius: 5px;
        }
        .d-flex justify-content-between mt-2 {
            display: none !important;
        }
        /* Основные стили для слайдера */
        .noUi-connect {
            background: #5FCB71; /* Цвет заполненной части */
        }
    </style>
{% endaddtoblock %}
{% addtoblock "js_footer" %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>
    <script src="{% static 'search/js/range.js' %}"></script>
{% endaddtoblock %}

<div class="accordion accordion-flush mb-2 range-accordion">
    <div class="accordion-item">
        <h2 class="accordion-header" id="range-heading-{{ field.id }}">
            <button class="accordion-button collapsed py-2"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#range-collapse-{{ field.id }}"
                    aria-expanded="false"
                    aria-controls="range-collapse-{{ field.id }}">
                {{ field.label }}
            </button>
        </h2>
        <div id="range-collapse-{{ field.id }}"
             class="accordion-collapse collapse"
             aria-labelledby="range-heading-{{ field.id }}">
            <div class="accordion-body pt-2">
                <div class="range-slider-wrapper mb-0"
                    data-field-name="{{ field.field_name }}"
                    data-min="{{ field.min_value|default:0 }}"
                    data-max="{{ field.max_value|default:100 }}"
                    data-step="{{ field.step|default:1 }}">
                    
                    <!-- Контейнер для слайдера -->
                    <div class="slider-container mb-3">
                        <!-- Сам слайдер (ДОЛЖЕН БЫТЬ ПУСТОЙ DIV) -->
                        <div class="slider" id="slider-{{ field.id }}"></div>
                        <!-- Поля для ручного ввода -->
                        <div class="row" style="margin-top: 35px;">
                            <div class="col">
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text">От</span>
                                    <input type="number" 
                                        class="form-control slider-min-input" 
                                        min="{{ field.min_value|default:0 }}"
                                        max="{{ field.max_value|default:100 }}"
                                        step="{{ field.step|default:1 }}">
                                </div>
                            </div>
                            <div class="col">
                                <div class="input-group input-group-sm">
                                    <span class="input-group-text">До</span>
                                    <input type="number" 
                                        class="form-control slider-max-input" 
                                        min="{{ field.min_value|default:0 }}"
                                        max="{{ field.max_value|default:100 }}"
                                        step="{{ field.step|default:1 }}">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Скрытые поля -->
                    <input type="hidden" name="{{ field.field_name }}_min" class="slider-hidden-min">
                    <input type="hidden" name="{{ field.field_name }}_max" class="slider-hidden-max">
                </div>
            </div>
        </div>
    </div>
</div>
